<!DOCTYPE html>
<html>
<head>
  <title>Scanner de QR Code</title>
  <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
</head>
<body>
  <h1>Escaneie o QR Code 2.0</h1>
  <div id="reader" style="width: 300px;"></div>
  <div id="result"></div>

  <script>
 const lastScanTime = {};
const scanCooldown = 5000; // 5 segundos em milissegundos

function onScanSuccess(decodedText) {
  const now = Date.now();

  if (!lastScanTime[decodedText] || (now - lastScanTime[decodedText] > scanCooldown)) {
    lastScanTime[decodedText] = now;

    document.getElementById('result').innerText = `Escaneado: ${decodedText}`;

    fetch('/api/save', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ sku: decodedText })
    })
    .then(res => res.json())
    .then(data => {
      if(data.success){
        atualizarContagens();
      } else {
        console.error('Erro no backend:', data.error);
      }
    })
    .catch(console.error);

  } else {
    console.log(`SKU ${decodedText} ignorado por cooldown.`);
  }
}
  </script>
  
</body>
</html>
